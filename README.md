
# ppap4lmp

PostProcess and Analysis Program for LAMMPS

## Documentation (generated by Doxygen)

* [GitHub Pages](https://irista56.github.io/ppap4lmp/)

### Documenting

1. Checkout to `gh-pages` branch.
2. Remove `docs/` from `.gitignore`.
3. Run `./documentation.py`.
4. To publish the documentation, push `docs/` directory as `origin/gh-pages`.
    ```bash
    git subtree push --prefix docs origin gh-pages
    ```

Note that local and remote `gh-pages` branch are different.

## Features

* Implemented by C++, Used from Python
* Data stored in Json structure
* Extensible without editing existing codes

## Installation

### via Conda

```bash
conda install -c irista56 ppap4lmp
```

### Development version

Just clone this repository and pip install.
Note that Eigen is required.

```bash
git clone --recursive https://github.com/irisTa56/ppap4lmp.git
cd ppap4lmp
pip install .
# (or) pip install -e .
# (or) pip install --user .
# (or) pip install --user -e .
```

Test your installation.

```bash
cd tests
tar xzvf archive.dumps_bead.tar.gz
tar xzvf archive.dumps_atom.tar.gz
python test.py
```

Tests can be conducted separately.

```bash
python test.py starter # filter, adder, processor
```

### Development version in Mac

#### If you prefer [Homebrew](https://brew.sh)

1. install dependencies

```bash
# install compiler and build tool
brew install gcc cmake
# install dependent libraries
brew install eigen pybind11
# install runtime dependency
brew install python; pip install numpy
```

2. get & build source

```bash
git clone --recursive https://github.com/irisTa56/ppap4lmp.git
cd ppap4lmp
export CXX=g++-8
pip install .
# (or) pip install -e .
# (or) pip install --user .
# (or) pip install --user -e .
```

3. run tests!

#### If you prefer Conda

1. install dependencies

```bash
conda install -c conda-forge \
  clangxx openmp cmake eigen pybind11 nlohmann_json numpy
```

2. get & build source; you do not need submodules

```bash
git clone https://github.com/irisTa56/ppap4lmp.git
cd ppap4lmp
export CXX=clang++  # Conda's clang++
export CXXFLAGS="-I/path/to/conda/include -L/path/to/conda/lib"
# (example) export CXXFLAGS="-I$HOME/miniconda3/include -L$HOME/miniconda3/lib"
pip install .
# (or) pip install -e .
# (or) pip install --user .
# (or) pip install --user -e .
```

3. run tests!

### Profiling

Install a profiling tools library.

```bash
conda install gperftools  # need conda-forge channel
```

Append the below line to `CMakeLists.txt`.

```bash
target_link_libraries(_ppap4lmp PRIVATE profiler)
```

Build & install.

#### Profiling tests

Run the below command instead of `python test.py`.

```bash
CPUPROFILE=sample.prof python test.py
# sample.prof (output)
```

Profile interactively.

```bash
pprof ../ppap4lmp/_ppap4lmp.cpython-36m-x86_64-linux-gnu.so sample.prof
```



## Acknowledgement

This project would not be possible without the following great open-source projects.

* [pybind/cmake_example](https://github.com/pybind/cmake_example)
* [pybind11](https://github.com/pybind/pybind11)
* [Eigen](http://eigen.tuxfamily.org/index.php?title=Main_Page)
* [nlohmann/json](https://github.com/nlohmann/json)

## Known Bugs

* `Error in 'python': double free or corruption (out):` occurs when exiting from Jupyter.
